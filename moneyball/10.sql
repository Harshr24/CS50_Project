SELECT p.first_name, p.last_name, s.salary, p2.year, p2.HR FROM players p JOIN salaries s ON p.id = s.player_id JOIN (SELECT player_id, year, HR, ROW_NUMBER() OVER (PARTITION BY player_id, year ORDER BY HR DESC, salary DESC) as rn FROM performances) p2 ON p.id = p2.player_id AND s.year = p2.year WHERE p.id = p2.player_id ORDER BY p.id, p2.year DESC, p2.HR DESC, s.salary DESC;
